<div class="container wrapper">
  <div class="mx-3 d-flex justify-content-center flex-column align-items-center" data-controller="full-screen-gallery add-gallery-pictures">

    <div class="profile-picture d-flex justify-content-center pt-3 pb-3">
      <% if current_user.profile_picture.attached? %>
        <%= cl_image_tag current_user.profile_picture.key, crop: :fill, class: "avatar-profile" %>
      <% elsif current_user.avatar_url.present? %>
        <%= image_tag current_user.avatar_url, class: 'avatar-profile' %>
      <% else %>
        <%= image_tag "user.png", class: 'avatar-profile' %>
      <% end %>
    </div>

    <h4 class= "d-flex justify-content-center pb-3"><%= current_user.full_name %></h4>

    <div class="my-3">
      <p class="title-profile">Gallerie photos ðŸ“¸</p>
    </div>
    <%= form_with url: add_gallery_users_path(user_id: current_user.id), method: :post, local: true, html: { multipart: true, data: { target: "full-screen-gallery.form" }  } do |form| %>
      <%= form.file_field :gallery_pictures, multiple: true, hidden: true, data: { target: "add-gallery-pictures.fileInput" } %>
    <% end %>

      <% if current_user.gallery_pictures.attached? %>
        <div class="d-flex justify-content-center mt-4">
          <div class="image-gallery d-flex flex-wrap align-items-center mb-4">
            <% current_user.gallery_pictures.each_with_index do |image, index| %>
              <div class="d-flex flex-column justify-content-center">
                <%= link_to(delete_gallery_users_path(user_id: current_user.id, image_key: image.key), method: :delete, onclick: "return confirm('ÃŠtes vous sÃ»r de vouloir supprimer cette photo ?');", class: "delete-link") do %>
                  <i class="fa-sharp fa-solid fa-circle-xmark delete-icon"></i>
                <% end %>
                <a href="#" data-action="click->full-screen-gallery#showImage" data-index="<%= index %>">
                  <div class="image-wrapper image-container">
                      <%= cl_image_tag(image.key, class: 'img-fluid square-image', data: { full_screen_gallery_target: 'galleryImage', src: cl_image_path(image.key, width: 800, height: 600, crop: :fill) }) %>
                    <div class="spinner-wrapper spinner-small" data-full-screen-gallery-target="smallSpinner">
                      <div class="spinner-border text-primary" role="status">
                        <span class="sr-only">Loading...</span>
                      </div>
                    </div>
                  </div>
                </a>
              </div>
            <% end %>

          <div class="add-slot-profile" data-action="click->add-gallery-pictures#addImages">
            <i class="fa-solid fa-plus"></i>
          </div>

          <!-- Full-screen gallery -->
          <div class="full-screen-gallery">
            <img src="" class="full-screen-gallery-image" data-full-screen-gallery-target="image">
            <div class="spinner-wrapper" data-full-screen-gallery-target="spinner">
              <div class="spinner-border text-light" role="status">
                <span class="sr-only">Loading...</span>
              </div>
            </div>
          </div>
          <div data-full-screen-gallery-target="icons" class="d-none">
            <button class="full-screen-gallery-prev" data-action="click->full-screen-gallery#prevImage"><i class="fa-solid fa-chevron-left"></i></button>
            <button class="full-screen-gallery-next" data-action="click->full-screen-gallery#nextImage"><i class="fa-solid fa-chevron-right"></i></button>
            <button class="full-screen-gallery-close" data-action="click->full-screen-gallery#hideGallery"><i class="fa-solid fa-xmark"></i></button>
          </div>
        </div>
        <% end %>
        </div>

      <div class="block-info-profile">
        <p class="title-profile text-align-center">Informations rÃ©servations ðŸ‘‡</p>
        <div class= "d-flex mt-2 d-flex align-items-center justify-content-between block-info-profile">
          <p class="mb-0"><i class="fa-solid fa-user me-2"></i><%= link_to "Informations personnelles",  edit_info_users_path, class: "btn-profile" %></p>
          <div><i class="fa-solid fa-angle-right"></i></div>
        </div>
        <div class= "d-flex mt-2 d-flex align-items-center justify-content-between block-info-profile">
          <p class="mb-0"><i class="fa-sharp fa-solid fa-clock me-2"></i><%= link_to "DisponibilitÃ©s hebdomadaires",  edit_dispo_users_path, class: "btn-profile my-4" %></p>
          <div><i class="fa-solid fa-angle-right"></i></div>
        </div>
        <div class= "d-flex mt-2 d-flex align-items-center justify-content-between block-info-profile">
          <p class="mb-0"><i class="fa-solid fa-xmark me-2"></i><%= link_to "IndisponibilitÃ©s hebdomadaires",  edit_indispo_users_path, class: "btn-profile my-4" %></p>
          <div><i class="fa-solid fa-angle-right"></i></div>
        </div>
        <div class= "d-flex mt-5 d-flex align-items-center justify-content-center block-link-profile">
          <%= link_to reservation_link(current_user.token) do %>
            <p class="p-0"></i>Lien de partage</p>
          <% end %>
        </div>
      </div>
    </div>
    <%# <p class="my-5 text-center mx-3">Contacte nous si tu souhaites modifier ton profil, les changements arrivent vite ðŸš€ !</p> %>


    <div class= "d-flex justify-content-center mt-1">
      <p><%=link_to "Se dÃ©connecter", destroy_user_session_path, data: {turbo_method: :delete}, onclick: "return confirm('ÃŠtes vous sÃ»r de vouloir vous dÃ©connecter ?');", class: "btn-minimal-red w-100" %></p>
    </div>


  </div>
</div>

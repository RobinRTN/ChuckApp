<div class="container">

  <div class="mx-3 mb-3 d-flex justify-content-between align-items-center">
    <h2 class="mb-0">Mes disponibilit√©s</h2>
  </div>
  <% pattern = "%H:%M"  %>
  <div class="mx-3 available">
    <% @full_datetimes.each do |weekly_datetimes| %>
      <% date = weekly_datetimes.first.first %>
      <% if date.between?(Date.today.beginning_of_week, Date.today.end_of_week) %>
        <p><%= "Cette semaine" %></p>
      <% elsif date.between?(Date.today.beginning_of_week + 1.week, Date.today.end_of_week + 1.week) %>
        <p><%= "Semaine prochaine" %></p>
      <% elsif date.between?(Date.today.beginning_of_week + 2.week, Date.today.end_of_week + 2.week) %>
        <p><%= "Dans 2 semaines" %></p>
      <% elsif date.between?(Date.today.beginning_of_week + 3.week, Date.today.end_of_week + 3.week) %>
        <p><%= "Dans 3 semaines" %></p>
      <%else%>
      <% end %>
      <% weekly_datetimes.each_with_index do |daily_datetimes, daily_index| %>
        <div class="daily-dispo-card mb-2">
          <% unless daily_datetimes.empty?  %>
          <p class="date-text"><%= l(daily_datetimes.first, format: "%A %d %B").capitalize %></p>
          <%end %>

          <div class="available-block">
            <%array_size = daily_datetimes.size %>
            <%if array_size > 4 %>
              <div class="dispo-slots">
                <% daily_datetimes.first(4).each do |datetime| %>
                  <%= link_to datetime.strftime(pattern), new_booking_path(datetime), class: "disponibilites-btn my-1 mx-1" %>
                <%end%>
              </div>
              <div class="dispo-slots-drop" id="drop-down-dispo-block-<%=daily_index%>" style="display:none;">
                <% daily_datetimes.each_with_index do |datetime, index| %>
                  <%if index >= 4 %>
                    <%= link_to datetime.strftime(pattern), new_booking_path(datetime), class: "disponibilites-btn my-1 mx-1" %>
                  <% end %>
                <%end%>
              </div>
              <button class="btn-disponibilites d-flex justify-content-center align-items-center">
                Voir plus</i>
              </button>

            <%else%>
              <div class="dispo-slots">
                <% daily_datetimes.each do |datetime| %>
                  <%= link_to datetime.strftime(pattern), new_booking_path(datetime), class: "disponibilites-btn my-1 mx-1" %>
                <%end%>
              </div>
            <%end %>
          </div>
        </div>
      <%end%>
    <%end%>
  </div>
</div>

<script>
  // Get all the drop-down buttons
  let dropDownButtons = document.querySelectorAll('.btn-disponibilites');

  // Add click event listeners to all the drop-down buttons
  dropDownButtons.forEach(function(button) {
    button.addEventListener('click', function() {
      // Get the corresponding drop-down block
      let dropDownBlock = button.previousElementSibling;
      // Toggle the display of the drop-down block
      if (dropDownBlock.style.display === 'none') {
        dropDownBlock.style.display = 'grid';
      } else {
        dropDownBlock.style.display = 'none';
      }
    });
  });

</script>

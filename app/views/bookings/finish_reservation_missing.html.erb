<div class="container wrapper">
  <div class="px-3 pb-4 d-flex align-items-center">
    <% booking_option = @existing_user == "true" ? "yes" : "no" %>
    <%= link_to choose_reservation_path(@user.token, formule_id: @formule.id, booking_option: booking_option), class: "text-decoration-none" do %>
      <div class="back-btn me-3">
        <i class="fa-solid fa-arrow-left"></i>
      </div>
    <% end %>
    <h4 class="m-0"></h4>
  </div>
  <p class="mx-3 mb-4"><strong>RÃ©capitulatif de la rÃ©servation en cours</strong></p>
  <div class="recap-card mx-3">
    <div class="d-flex align-items-center justify-content-start finish-card">
      <div class="d-flex justify-content-center">
        <% if @user.profile_picture.attached? %>
          <%= cl_image_tag @user.profile_picture.key, crop: :fill, class: "avatar-bigger" %>
        <% elsif @user.avatar_url.present? %>
          <%= image_tag @user.avatar_url, class: 'avatar-bigger' %>
        <% else %>
          <%= image_tag "user.png", class: 'avatar-bigger' %>
        <% end %>
      </div>
      <div class="d-flex flex-column">
        <h4><%= @user.full_name %></h4>
        <p><%= @user.title %></p>
      </div>
    </div>
  </div>
  <div class="d-flex mt-3 mx-4 border-bottom pb-3">
    <div class="finish-details-card flex-column align-items-start justify-content-start">
      <p><i class="fa-solid fa-fire me-2"></i> <%= @formule.name %></p>
      <p><i class="fa-solid fa-clock me-2"></i> <%= @formule.duration %> minutes</p>
      <p class="btn-disponibilites"><i class="fa-solid fa-coins me-2"></i> <%= @formule.price.to_i %> â‚¬</p>
      <p><i class="fa-solid fa-calendar me-2"></i> <%= date_time = l(DateTime.parse(@datetime),format: '%A %d %B de %Hh%M').capitalize %> Ã  <%= l(DateTime.parse(@datetime) + @formule.duration.minutes, format: '%Hh%M') %></p>
    </div>
  </div>




  <div class="form-new-client mx-3">
    <%= simple_form_for @booking do |f| %>
      <% start_time = DateTime.parse(@datetime) %>
      <% end_time = start_time + @formule.duration.minutes %>
      <%= f.input :start_time, as: :hidden, input_html: { value: start_time } %>
      <%= f.input :end_time, as: :hidden, input_html: { value: end_time } %>
      <%= f.input :payment_status, as: :hidden, input_html: { value: "Non rÃ©glÃ©" } %>
      <%= f.input :price, as: :hidden, input_html: { value: @formule.price } %>
      <%= f.input :user_id, as: :hidden, input_html: { value: @user.id } %>
      <%= f.input :booking_type, as: :hidden, input_html: { value: "Individuel" } %>
      <%= f.fields_for :client do |client_fields| %>
        <div class="form-group">
          <p><strong>Renseigne tes informations personnelles ðŸ‘‡</strong></p>
          <div class="d-flex w-100 justify-content-between">
            <%= client_fields.input :first_name, required: true, label: false, input_html: { class: "form-box-half me-2", placeholder: "PrÃ©nom" } %>
            <%= client_fields.input :last_name, required: true, label: false, input_html: { class: "form-box-half ms-2", placeholder: "Nom de famille" } %>
          </div>
          <%= client_fields.input :phone_number, required: true, label: false, input_html: { class: "form-box", placeholder: "NumÃ©ro de tÃ©lÃ©phone" } %>
          <%= client_fields.input :email, required: true, label: false, input_html: { class: "form-box", placeholder: "Adresse email" } %>
          <p>Photo de profil (facultatif)</p>
          <%= client_fields.input :photo, as: :file, input_html: { class: "form-box" }, label: false %>
        </div>
      <% end %>
      <%= f.fields_for :back do |client_fields| %>
          <%= client_fields.input :datetime, as: :hidden, input_html: { value: @datetime }  %>
          <%= client_fields.input :formule, as: :hidden, input_html: { value: @formule.id }  %>
          <%= client_fields.input :existing_user, as: :hidden, input_html: { value: @existing_user }  %>
      <% end %>

      <p class="mt-4"><strong>Ajoute un message Ã  ta demande ðŸ‘‡</strong></p>
      <%= f.input :message, label: false %>
      <%= f.button :submit, "Envoyer la demande de rÃ©servation", class: "btn-basic-bleu-large mt-4" %>
    <% end %>
      <div class="mt-3">
        <small><em>Tu receveras un e-mail de confirmation de la demande.</em></small>
        <small><em>Attends ensuite la confirmation par e-mail du professionnel ! </em></small>
      </div>
  </div>
</div>

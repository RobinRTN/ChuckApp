<div class="container wrapper">
  <div class="px-3 pb-4 d-flex align-items-center">
    <% booking_option = @existing_user ? "yes" : "no" %>
    <%= link_to choose_reservation_path(@user.token, formule_id: @formule.id, booking_option: booking_option), class: "text-decoration-none" do %>
      <div class="back-btn me-3">
        <i class="fa-solid fa-arrow-left"></i>
      </div>
    <% end %>
    <h4 class="m-0">Nouvelle réservation</h4>
  </div>
  <p class="mx-3 mb-4">Récapitulatif de la réservation en cours 👍</p>
  <div class="recap-card mx-3">
    <div class="d-flex align-items-center justify-content-start finish-card">
      <div class="d-flex justify-content-center">
        <% if current_user.profile_picture.attached? %>
          <%= cl_image_tag current_user.profile_picture.key, crop: :fill, class: "avatar-bigger" %>
        <% elsif current_user.avatar_url.present? %>
          <%= image_tag current_user.avatar_url, class: 'avatar-bigger' %>
        <% else %>
          <%= image_tag "user.png", class: 'avatar-bigger' %>
        <% end %>
      </div>
      <div class="d-flex flex-column">
        <h4><%= @user.full_name %></h4>
        <p><%= @user.title %></p>
      </div>
    </div>
  </div>
  <div class="d-flex justify-content-center mt-3 border-bottom pb-3">
    <div class="formule-card-selected d-flex flex-column align-items-center justify-content-center">
      <h4><%= @formule.name %></h4>
      <p><%= @formule.duration %> minutes</p>
      <p class="btn-disponibilites"><%= @formule.price.to_i %> €</p>
    </div>
  </div>




    <% if @existing_user %>
      <div class="form-new-client mx-3">
        <%= simple_form_for @booking do |f| %>
          <% start_time = Date.parse(@datetime) %>
          <% end_time = start_time + @formule.duration.minutes %>
          <%= f.input :start_time, as: :hidden, input_html: { value: start_time } %>
          <%= f.input :end_time, as: :hidden, input_html: { value: end_time } %>
          <%= f.input :payment_status, as: :hidden, input_html: { value: "Non réglé" } %>
          <%= f.input :price, as: :hidden, input_html: { value: @formule.price } %>
          <%= f.input :user_id, as: :hidden, input_html: { value: @user.id } %>
          <%= f.input :booking_type, as: :hidden, input_html: { value: "Individuel" } %>
          <%= f.fields_for :client do |client_fields| %>
            <div class="form-group">
              <p>Renseigne ton adresse email 👇</p>
              <%= client_fields.input :email, required: false, label: false, input_html: { class: "form-control" } %>
            </div>
          <% end %>
          <p class="mt-4">Ajoute un message à ta demande</p>
          <%= f.input :message, label: false %>
          <%= f.button :submit, "Envoyer la demande de réservation", class: "btn-basic-bleu-large mt-4" %>
        <% end %>
          <div class="mt-3">
            <small><em>Tu receveras un e-mail de confirmation de la demande.</em></small>
            <small><em>Attends ensuite la confirmation par e-mail du professionnel ! 👍</em></small>
          </div>
      </div>
    <% else %>
    <%end %>
</div>
